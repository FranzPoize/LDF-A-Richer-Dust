<!doctype html>
<html>
<head>
	<title>Admin A richer dust</title>
	<style>
	* { margin: 0; padding: 0; box-sizing: border-box; }
	body { font: 13px Helvetica, Arial; }


	#admin{
		display: grid;
	}

	form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; }
	form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
	form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
	#infos{
		top:0;
		width:100%;
		position: fixed;
		background: #DDD;
		height: 200px;
	}
	#chrono{
		font-size: 160px;
		font-family: monospace;
	}
	#messages {
		list-style-type: none;
		margin: 0;
		margin-top:200px;
		padding: 0;
	}
	#messages li {
		padding: 5px 10px;
	}
	#messages li:nth-child(odd) {
		background: #eee;
	}

	.millis{
		font-size: 0.5em;
	}
</style>
</head>
<body>

	<div id="admin">

		<div id="infos">
			<span id="chrono"><span class="hours">00</span>:<span class="minutes">00</span>:<span class="seconds">00</span>.<span class="millis">000</span></span>
			<button id="play">play</button>
			<button id="pause">pause</button>
			<button id="stop">stop</button>
		</div>
		<ul id="messages"></ul>
		<form action="">
			<input id="m" autocomplete="off" /><button>Send</button>
		</form>


	</div>

	<script src="/socket.io/socket.io.js"></script>
	<script src="https://code.jquery.com/jquery-1.11.1.js"></script>

	<!-- http://workshop.chromeexperiments.com/examples/gui/#4--Color-Controllers -->

	<script>
		$(function () {

			var chronometre;
			var startDate, pauseDate, prevDate;
			var pauseDuration = 0;
			var isPlaying = false;
			var isPaused;

			$("#pause").hide();


			var socket = io();
			$('form').submit(function(){
				socket.emit('chat message', $('#m').val());
				$('#m').val('');
				return false;
			});
			socket.on('chat message', function(msg){
				$('#messages').append($('<li>').text(msg));
			});


			$("#play").click(function(){
				if(isPlaying === false){
					startDate = new Date();
					chronometre = setInterval(function(){ myTimer() }, 1000/25);
				}
				isPaused = false;
				isPlaying = true;
				$("#pause").show();
				$("#play").hide();
			});
			$("#pause").click(function(){
				isPaused 		= true;
				pauseDate 		= new Date();
				$("#pause").hide();
				$("#play").show();
			});
			$("#stop").click(function(){
				isPaused		= true;
				isPlaying 		= false;
				pauseDuration 	= 0;
				clearInterval( chronometre );
				$("#chrono").html( '<span class="hours">00</span>:<span class="minutes">00</span>:<span class="seconds">00</span>.<span class="millis">000</span>' );
				$("#pause").hide();
				$("#play").show();
			});

			
			function myTimer() {
			    let currentDate = new Date();
			    if(isPaused === true){
			    	pauseDuration += currentDate - prevDate;
			    }
			    if(isPaused !== true){
				    d =  getDuration( currentDate - startDate - pauseDuration);
				    $("#chrono").html( timecode(d) );
				}
			    prevDate = new Date();
			}		

		});



		function timecode(millis){
			return "<span class='hours'>"+FormatNumberLength(millis.hours,2)+"</span>:<span class='minutes'>"+FormatNumberLength(millis.minutes,2)+"</span>:<span class='seconds'>"+FormatNumberLength(millis.seconds,2)+"</span>.<span class='millis'>"+FormatNumberLength(millis.millis,3)+"</span>";
		}

		// https://stackoverflow.com/questions/175554/how-to-convert-milliseconds-into-human-readable-form
		function getDuration(millis){
		    var dur = {};
		    var units = [
		        {label:"millis",    mod:1000},
		        {label:"seconds",   mod:60},
		        {label:"minutes",   mod:60},
		        {label:"hours",     mod:24},
		        {label:"days",      mod:31}
		    ];
		    // calculate the individual unit values...
		    units.forEach(function(u){
		        millis = (millis - (dur[u.label] = (millis % u.mod))) / u.mod;
		    });
		    // convert object to a string representation...
		    var nonZero = function(u){ return dur[u.label]; };
		    dur.toString = function(){
		        return units
		            .reverse()
		            .filter(nonZero)
		            .map(function(u){
		                return dur[u.label] + " " + (dur[u.label]==1?u.label.slice(0,-1):u.label);
		            })
		            .join(', ');
		    };
		    return dur;
		};

		// https://stackoverflow.com/questions/1127905/how-can-i-format-an-integer-to-a-specific-length-in-javascript
		function FormatNumberLength(num, length) {
		    var r = "" + num;
		    while (r.length < length) {
		        r = "0" + r;
		    }
		    return r;
		}

	</script>
</body>
</html>